find_package(Pthreads)

if (PTHREADS_FOUND)
    set(GMOCK_DIR ${CMAKE_CURRENT_SOURCE_DIR})
    set(GTEST_DIR ${GMOCK_DIR}/gtest)
    set(GTEST_SOURCES ${GTEST_DIR}/src/gtest-all.cc)
    set(GMOCK_SOURCES ${GMOCK_DIR}/src/gmock-all.cc)

    set(GTEST_INCLUDE_DIRS ${GTEST_DIR}/include)
    set(GMOCK_INCLUDE_DIRS ${GMOCK_DIR}/include ${GTEST_INCLUDE_DIRS})
    if (GMX_USE_GMOCK)
        set(GMX_USE_GTEST ON)
        include_directories(${GTEST_INCLUDE_DIRS})
        include_directories(${GTEST_DIR})
        include_directories(${GMOCK_INCLUDE_DIRS})
        include_directories(${GMOCK_DIR})
        add_library(gmock STATIC ${GMOCK_SOURCES} ${GTEST_SOURCES})
        set(GMOCK_LIBRARIES gmock ${PTHREADS_LIBRARIES} PARENT_SCOPE)
    endif (GMX_USE_GMOCK)
    if (GMX_USE_GTEST)
        include_directories(${GTEST_INCLUDE_DIRS})
        include_directories(${GTEST_DIR})
        add_library(gtest STATIC ${GTEST_SOURCES})
        set(GTEST_LIBRARIES gtest ${PTHREADS_LIBRARIES} PARENT_SCOPE)
    endif (GMX_USE_GTEST)
    set(GMX_USE_GTEST ${GMX_USE_GTEST} PARENT_SCOPE)
    set(GTEST_INCLUDE_DIRS ${GTEST_INCLUDE_DIRS} PARENT_SCOPE)
    set(GMOCK_INCLUDE_DIRS ${GMOCK_INCLUDE_DIRS} PARENT_SCOPE)
else (PTHREADS_FOUND)
    set(GMX_USE_GTEST OFF PARENT_SCOPE)
    set(GMX_USE_GMOCK OFF PARENT_SCOPE)
endif (PTHREADS_FOUND)
